<!DOCTYPE html>
<html>
<head>
  <title>2048 Game in Elm</title>
</head>
<body>
  <div id="game">itest</div>
  <div id="text">Hello, world</div>

  <script type="text/javascript" src="build/elm.js"></script>
  <script type="text/javascript">
    // Make sure page is not scrolling on keypress and keydown
    document.addEventListener('keydown', 
        function preventScroll(e) {
          if(e.which == 38 || e.which == 40) {
            e.preventDefault();
            return false;
          }
          return true;
        });

    function size(el) {
      var rect = el.getBoundingClientRect();
      return {
        width: rect.width, 
        height: rect.height,
        windowWidth: window.innerWidth,
        windowHeight: window.innerHeight
      };
    }

    var KEY = "game2048elm";

    function init(container) {
      var ret = {
        score: 0,
        best: 0,
        initialBoard: [],
        size: size(container) 
      };
      if (window.localStorage) {
        try {
          var obj = JSON.parse(localStorage.getItem(KEY));
          ret.score = obj[0];
          ret.best = obj[1];
          ret.initialBoard = obj[2];
        } catch (e) {}
      }

      return ret;
    }

    function save(data) {
      if (window.localStorage) {
        localStorage.setItem(KEY, JSON.stringify(data));
      }
    }

    var container = document.getElementById('game');
    var app = Elm.Game2048.embed(container, init(container));
    app.ports.save.subscribe(save);

    window.onresize = function() {
      app.ports.size.send(size(container));
    };
  </script>
</body>
</html>
